/* styles/04-components/global-header.css */

#global-header {
    position: fixed;
    top: 0;
    left: 0;
    z-index: 100;
    width: 100%;
    min-height: var(--twelve-x);
    background-color: var(--color-header-bg, transparent);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
}

#global-header .grid-wrapper {
    grid-template-areas: "logo logo main-content main-content main-content main-content main-content main-content main-content main-content main-content main-content";
    align-items: center;
}

.header-logo {
    grid-area: logo;
    min-height: var(--twelve-x);
    padding: var(--four-x);
    display: flex;
    position: relative;
    background:
        var(--brackets) left -8px top -8px no-repeat,
        var(--brackets) right -8px top -8px no-repeat,
        var(--brackets) right -8px bottom -8px no-repeat,
        var(--brackets) left -8px bottom -8px no-repeat;
}

.logo {
    min-width: var(--five-x);
    min-height: var(--three-x);
    color: var(--color-header-logo, var(--color-accent-1));
}

.header-main-content {
    min-height: var(--twelve-x);
    grid-area: main-content;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    padding: var(--three-x) var(--four-x);
    gap: var(--two-x);
    background:
        var(--brackets) left -9px top -8px no-repeat,
        var(--brackets) right -8px top -8px no-repeat,
        var(--brackets) right -8px bottom -8px no-repeat,
        var(--brackets) left -9px bottom -8px no-repeat;
}

.header-title {
    display: flex;
    flex: 1;
    min-width: 0;
    /* Desktop: Row alignment */
    flex-direction: row; 
    align-items: baseline;
    justify-content: flex-start; /* Ensures everything sits on the left */
    gap: var(--one-and-a-half-x); /* Space between name and role */
    font-size: var(--font-size-xsmall);
    font-variation-settings:
        "wght" var(--font-weight-medium),
        "wdth" var(--font-width-regular);
    line-height: var(--line-height-default);
    letter-spacing: var(--letter-spacing-loose);
}

.header-title .name,
.header-title .role {
    /* Prevent individual words from wrapping */
    white-space: nowrap; 
    display: inline-block;
}

.header-title .name {
    white-space: nowrap;
    padding-right: .75em;
    font-variation-settings:
        "wght" var(--font-weight-semibold);
    color: var(--color-header-name, var(--color-text));
}

.header-title .role {
    color: var(--color-header-role, var(--color-text-meta));
    white-space: nowrap;
    font-variation-settings:
        "wght" var(--font-weight-regular);
}

#global-header .header-nav {
    display: flex;
    align-items: center;
    padding-right: var(--four-x);
}

.header-nav ul {
    display: flex;
    gap: var(--three-x);
    list-style: none;
    margin: 0;
    padding: 0;
    align-items: center;
}

.header-nav ul li {
    font-size: var(--font-size-xsmall);
    font-variation-settings:
        "wght" var(--font-weight-semibold),
        "wdth" var(--font-width-regular);
    line-height: var(--line-height-default);
    letter-spacing: var(--letter-spacing-loose);
    background-color: transparent;
    margin-top: 0;
    margin-bottom: 0;
    max-width: none;
}

.header-nav ul li a {
    padding: .25rem .5rem;
    text-decoration: none; 
    color: var(--color-text);
    border-radius: var(--radius-small);
}

.header-nav ul li a:hover {
    cursor: pointer;
}

.header-nav ul li a:visited {
    color: var(--color-text);
}

/* ======================= */
/* Hamburger menu (mobile) */
/* ======================= */

#main-nav {
    display: flex;
    align-items: center;
}

#menu-trigger {
    display: none;
    flex-direction: column;
    justify-content: center; /* Vertical center */
    align-items: center;     /* Horizontal center */
    width: 44px;
    height: 44px;
    background: transparent;
    border: none;
    cursor: pointer;
    z-index: 1001;
    position: relative;
    padding: 0;
}

#menu-trigger .bar {
    width: 24px;
    height: 2px;
    background-color: var(--color-header-name, var(--color-text));
    border-radius: 2px;
    transition: transform var(--transition-default), opacity var(--transition-default);
    /* Initial spacing using margins is safer than absolute positioning */
    margin: 3px 0; 
}

/* Transform into a symmetrical X */
.menu-open #menu-trigger .bar:nth-child(1) {
    /* Move down half the gap + half the bar height, then rotate */
    transform: translateY(4px) rotate(45deg);
}

.menu-open #menu-trigger .bar:nth-child(2) {
    /* Move up half the gap + half the bar height, then rotate */
    transform: translateY(-4px) rotate(-45deg);
}

.mobile-only {
    display: none; /* Hidden on desktop */
}

/* =================== */
/* Theme toggle button */
/* =================== */

.theme-toggle-button {
    padding: .25rem .5rem;
    border: none;
    background-color: transparent;
    color: var(--color-text);
    border-radius: var(--radius-small);
    cursor: pointer;
}

.theme-icon {
    min-width: var(--three-x);
    min-height: var(--three-x);
}

/* Target the sun/moon body and all rays */

.morph-body, 
[class^="morph-ray-"] {
    stroke: var(--color-icon);
    stroke-width: 1.5;
    stroke-linecap: round;
}

.morph-body {
    fill: none;
}

/* Initial state - rays visible for light theme */

[class^="morph-ray-"] {
    opacity: 1;
    transform-origin: center;
}

/* Dark theme - hide outer rays */

[data-theme="dark"] .morph-ray-4,
[data-theme="dark"] .morph-ray-5,
[data-theme="dark"] .morph-ray-6,
[data-theme="dark"] .morph-ray-7,
[data-theme="dark"] .morph-ray-8,
[data-theme="dark"] .morph-ray-9,
[data-theme="dark"] .morph-ray-10,
[data-theme="dark"] .morph-ray-11 {
    opacity: 0;
}

/* Safari-specific: Ensure smooth transitions */

.is-safari .theme-icon {
    will-change: opacity;
}

.is-safari .morph-body,
.is-safari [class^="morph-ray-"] {
    /* Disable path transitions in Safari */
    transition: opacity var(--transition-default), 
                stroke var(--transition-default);
}

/* ============= */
/* Media queries */
/* ============= */

/* --- Mobile Menu Logic (Below 768px) --- */

/* Prevent transitions during resizing to avoid jank */
.resizing #main-nav {
    transition: none !important; /* Keep - needs to override everything */
    opacity: 0 !important; /* Keep - critical for Safari fix */
}

/* Safari-specific: Nuclear option */
.is-safari.resizing #main-nav,
.is-safari.resizing #main-nav * {
    transition: none !important; /* Keep - critical override */
    animation: none !important; /* Keep - critical override */
    opacity: 0 !important; /* Keep - Safari fix */
    visibility: hidden !important; /* Keep - Safari fix */
}

@media (max-width: 768px) {
    #main-nav {
        position: fixed;
        top: 0;
        right: 0;
        width: 100%;
        height: 100vh; /* Fallback for older browsers */
        height: 100dvh; /* Dynamic viewport height for modern browsers */
        background-color: var(--color-background);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        
        transform: translateX(100%);
        visibility: hidden;
        pointer-events: none;
        
        transition: transform var(--transition-default), 
                    visibility var(--transition-default);
        
        -webkit-transform: translateX(100%);
        will-change: transform;
    }

    .is-safari #main-nav {
        -webkit-backface-visibility: hidden;
        -webkit-perspective: 1000;
    }

    #main-nav ul {
        transition: none;
        flex-direction: column;
        gap: var(--six-x);
    }

    .menu-open #main-nav {
        transform: translateX(0);
        -webkit-transform: translateX(0);
        visibility: visible;
        pointer-events: auto;
    }

    /* KEEP !important - Needed to override .menu-open state */
    .resizing #main-nav {
        pointer-events: none !important;
    }

    .mobile-only {
        display: block;
    }

    .header-nav ul {
        flex-direction: column;
        gap: var(--six-x);
    }

    .header-nav ul.nav-links {
        flex-direction: column;
        gap: var(--six-x);
    }

    .header-nav ul.nav-links li {
        font-size: var(--font-size-large);
    }

    .menu-open #menu-trigger .bar:nth-child(1) {
        transform: translateY(4px) rotate(45deg);
    }
    
    .menu-open #menu-trigger .bar:nth-child(2) {
        transform: translateY(-4px) rotate(-45deg);
    }

    #menu-trigger {
        display: flex;
    }
    
    /* âœ… Removed !important - this should work without it */
    .header-main-content {
        overflow: visible;
    }
}

@media (max-width: 960px) {
    .header-title {
        flex-direction: column; /* Stack name over role */
        align-items: flex-start; /* Keep both left-aligned when stacked */
        gap: 0;
    }

    .header-title .name,
    .header-title .role {
        /* Even when stacked, we keep them from wrapping internally 
           unless they literally exceed the screen width */
        white-space: nowrap; 
        line-height: var(--line-height-tight);
    }
}